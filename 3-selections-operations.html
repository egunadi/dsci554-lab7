<!DOCTYPE html>
<html>

<head>
  <title>DSCI 554 Lab</title>

  <link href="node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="./style.css">

  <link href="node_modules/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

  <script src="node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

  <link rel="stylesheet" href="./github-dark-dimmed.min.css">
  <script src="./highlight.min.js"></script>

  <script src="./node_modules/highlightjs-copy/dist/highlightjs-copy.min.js"></script>
  <link rel="stylesheet" href="./node_modules/highlightjs-copy/dist/highlightjs-copy.min.css" />

  <script>
    hljs.highlightAll();
    hljs.addPlugin(new CopyButtonPlugin());
  </script>

  <script src="./node_modules/d3/dist/d3.min.js"></script>
</head>

<body>
  <h1>ðŸ§ª Operations on selections</h1>

  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="index.html">Labs index</a></li>
      <li class="breadcrumb-item active" aria-current="page">ðŸ§ª Operations on selections</li>
    </ol>
  </nav>

  We are going to select <code>circle</code> elements in <code>g</code> groups

  <pre><code class="HTML">&lt;svg width="410" height="70" style="background-color: gainsboro" id="svg"&gt;
  &lt;g&gt;
    &lt;circle id="00" cx="10" cy="10" r="6" fill="#1b9e77"&gt;&lt;/circle&gt;
    &lt;circle id="10" cx="10" cy="35" r="6" fill="#1b9e77"&gt;&lt;/circle&gt;
    &lt;circle id="20" cx="10" cy="60" r="6" fill="#1b9e77"&gt;&lt;/circle&gt;
  &lt;/g&gt;
  &lt;g&gt;
    &lt;circle id="01" cx="150" cy="10" r="6" fill="#d95f02"&gt;&lt;/circle&gt;
    &lt;circle id="11" cx="150" cy="35" r="6" fill="#d95f02"&gt;&lt;/circle&gt;
    &lt;circle id="21" cx="150" cy="60" r="6" fill="#d95f02"&gt;&lt;/circle&gt;
  &lt;/g&gt;
  &lt;g&gt;
    &lt;circle id="02" cx="300" cy="10" r="6" fill="#7570b3"&gt;&lt;/circle&gt;
    &lt;circle id="22" cx="300" cy="35" r="6" fill="#7570b3"&gt;&lt;/circle&gt;
    &lt;circle id="32" cx="300" cy="60" r="6" fill="#7570b3"&gt;&lt;/circle&gt;
  &lt;/g&gt;
&lt;/svg&gt;</code></pre>

<svg width="410" height="70" style="background-color: gainsboro" id="svg">
  <g>
    <circle id="00" cx="10" cy="10" r="6" fill="#1b9e77"></circle>
    <circle id="10" cx="10" cy="35" r="6" fill="#1b9e77"></circle>
    <circle id="20" cx="10" cy="60" r="6" fill="#1b9e77"></circle>
  </g>
  <g>
    <circle id="01" cx="150" cy="10" r="6" fill="#d95f02"></circle>
    <circle id="11" cx="150" cy="35" r="6" fill="#d95f02"></circle>
    <circle id="21" cx="150" cy="60" r="6" fill="#d95f02"></circle>
  </g>
  <g>
    <circle id="02" cx="300" cy="10" r="6" fill="#7570b3"></circle>
    <circle id="22" cx="300" cy="35" r="6" fill="#7570b3"></circle>
    <circle id="32" cx="300" cy="60" r="6" fill="#7570b3"></circle>
  </g>
</svg>

<h3 class="mt-3">Selecting with selectAll()</h3>

<pre><code class="mt-2 HTML">&lt;script&gt;
  var selection = d3.select('#svg1').selectAll('circle')
  selection.attr('fill', 'steelblue');
&lt;/script&gt;</code></pre>

<code>id="svg1"</code>
<svg width="410" height="70" style="background-color: gainsboro" id="svg1">
  <g>
    <circle id="00" cx="10" cy="10" r="6" fill="#1b9e77"></circle>
    <circle id="10" cx="10" cy="35" r="6" fill="#1b9e77"></circle>
    <circle id="20" cx="10" cy="60" r="6" fill="#1b9e77"></circle>
  </g>
  <g>
    <circle id="01" cx="150" cy="10" r="6" fill="#d95f02"></circle>
    <circle id="11" cx="150" cy="35" r="6" fill="#d95f02"></circle>
    <circle id="21" cx="150" cy="60" r="6" fill="#d95f02"></circle>
  </g>
  <g>
    <circle id="02" cx="300" cy="10" r="6" fill="#7570b3"></circle>
    <circle id="22" cx="300" cy="35" r="6" fill="#7570b3"></circle>
    <circle id="32" cx="300" cy="60" r="6" fill="#7570b3"></circle>
  </g>
</svg>

<script>
  var selection = d3.select('#svg1').selectAll('circle')
  selection.attr('fill', 'red');
  console.log(selection);
</script>

<h3 class="mt-3">Using selection.each()</h3>

<p>See <a href="https://github.com/d3/d3-selection#selection_each" target="_blank">selection.each()</a> documentation.</p>

<p class="alert alert-info">Invokes the specified function for each selected element, in order, being passed the current datum (d), the current index (i), and the current group (nodes), with this as the current DOM element (nodes[i]). This method can be used to invoke arbitrary code for each selected element, and is useful for creating a context to access parent and child data simultaneously.</p>

<code>id="svg2"</code>
<svg width="410" height="70" style="background-color: gainsboro" id="svg2">
  <g>
    <circle id="00" cx="10" cy="10" r="6" fill="#1b9e77"></circle>
    <circle id="10" cx="10" cy="35" r="6" fill="#1b9e77"></circle>
    <circle id="20" cx="10" cy="60" r="6" fill="#1b9e77"></circle>
  </g>
  <g>
    <circle id="01" cx="150" cy="10" r="6" fill="#d95f02"></circle>
    <circle id="11" cx="150" cy="35" r="6" fill="#d95f02"></circle>
    <circle id="21" cx="150" cy="60" r="6" fill="#d95f02"></circle>
  </g>
  <g>
    <circle id="02" cx="300" cy="10" r="6" fill="#7570b3"></circle>
    <circle id="22" cx="300" cy="35" r="6" fill="#7570b3"></circle>
    <circle id="32" cx="300" cy="60" r="6" fill="#7570b3"></circle>
  </g>
</svg>

<pre><code class="mt-2 HTML">&lt;script&gt;
  d3.select('#svg2').selectAll('circle').each(function(p, j) {
    console.log('selection.each(): this ', j , this);
    d3.select(this).attr('fill', 'green');  //this is the current node
  });
&lt;/script&gt;</code></pre>

<script>
  d3.select('#svg2').selectAll('circle').each(function(p, j) {
    console.log('selection.each(): this ', j , this);
    d3.select(this).attr('fill', 'green');  //this is the current node
  });
</script>

<h3 class="mt-3">Using selection.call()</h3>

<p>See <a href="https://github.com/d3/d3-selection#selection_call" target="_blank">selection.call()</a> documentation.</p>

<p class="alert alert-info">Invokes the specified function exactly once, passing in this selection along with any optional arguments. Returns
  this selection. This is equivalent to invoking the function by hand but facilitates method chaining. </p>

<code>id="svg3"</code>
<svg width="410" height="70" style="background-color: gainsboro" id="svg3">
  <g>
    <circle id="00" cx="10" cy="10" r="6" fill="#1b9e77"></circle>
    <circle id="10" cx="10" cy="35" r="6" fill="#1b9e77"></circle>
    <circle id="20" cx="10" cy="60" r="6" fill="#1b9e77"></circle>
  </g>
  <g>
    <circle id="01" cx="150" cy="10" r="6" fill="#d95f02"></circle>
    <circle id="11" cx="150" cy="35" r="6" fill="#d95f02"></circle>
    <circle id="21" cx="150" cy="60" r="6" fill="#d95f02"></circle>
  </g>
  <g>
    <circle id="02" cx="300" cy="10" r="6" fill="#7570b3"></circle>
    <circle id="22" cx="300" cy="35" r="6" fill="#7570b3"></circle>
    <circle id="32" cx="300" cy="60" r="6" fill="#7570b3"></circle>
  </g>
</svg>

<pre><code class="mt-2 HTML">&lt;script&gt;
  d3.select('#svg3').selectAll('circle').call(function(selection) {
    selection.attr('fill', 'blue');
    console.log('selection.call(): selection ', selection, ' this ', this);  //this is the window
  });
&lt;/script&gt;</code></pre>

<script>
  d3.select('#svg3').selectAll('circle').call(function(selection) {
    selection.attr('fill', 'blue');
    console.log('selection.call(): selection ', selection, ' this ', this);  //this is the window
  });
</script>

<h3>Example to filter the selection</h3>

See <a href="https://github.com/d3/d3-selection#selection_filter" target="_blank">selection.filter()</a> documentation.

<p class="alert alert-info">Filters the selection, returning a new selection that contains only the elements for which the specified filter is
  true. The filter may be specified either as a selector string or a function. If the filter is a function, it is
  evaluated for each selected element, in order, being passed the current datum (d), the current index (i), and the
  current group (nodes), with this as the current DOM element (nodes[i]).</p>

<code>id="svg4"</code>
<svg width="410" height="70" style="background-color: gainsboro" id="svg4">
  <g>
    <circle id="00" cx="10" cy="10" r="6" fill="#1b9e77"></circle>
    <circle id="10" cx="10" cy="35" r="6" fill="#1b9e77"></circle>
    <circle id="20" cx="10" cy="60" r="6" fill="#1b9e77"></circle>
  </g>
  <g>
    <circle id="01" cx="150" cy="10" r="6" fill="#d95f02"></circle>
    <circle id="11" cx="150" cy="35" r="6" fill="#d95f02"></circle>
    <circle id="21" cx="150" cy="60" r="6" fill="#d95f02"></circle>
  </g>
  <g>
    <circle id="02" cx="300" cy="10" r="6" fill="#7570b3"></circle>
    <circle id="22" cx="300" cy="35" r="6" fill="#7570b3"></circle>
    <circle id="32" cx="300" cy="60" r="6" fill="#7570b3"></circle>
  </g>
</svg>

<pre><code class="mt-2 HTML">&lt;script&gt;
  d3.select('#svg4')
    .selectAll('circle')
    .filter((d, i) => i & 1)
    .call(d => d.attr('fill', 'orange'));
&lt;/script&gt;</code></pre>

<script>
  d3.select('#svg4')
    .selectAll('circle')
    .filter((d, i) => i & 1)
    .call(d => d.attr('fill', 'orange'));
</script>

  <div class="mt-3 text-end"><a href="#"><i class="bi bi-arrow-up"></i> top</a></div>
  
</body>

</html>
